# mp_reviews_bot
Бот часть проекта Проще - его задача обрабатывать и отвечать на отзывы пользователей.

## Минимальный доменный слой (MVP)

В репозитории добавлены базовые модели баланса/ledger и политика обработки событий.
Их можно использовать в сервисном слое при интеграции с БД и очередью задач.

### Основные сущности

- `OwnerAccount` — владелец с текущим балансом токенов и политикой обработки после пополнения.
- `LedgerEntry` — запись о движении токенов (списание, пополнение).
- `BillingService` — сервис списания и пополнения токенов у owner.
- `EventProcessingPolicy` — блокирует парсинг/генерацию при нулевом балансе и задаёт окно после пополнения.

### Поведение при нулевом балансе

- Любая генерация и парсинг новых событий блокируются.
- После пополнения выбирается политика: обработать накопленные события или только новые.

### Выбор поведения после пополнения

`BillingService.top_up` принимает `policy`, а `EventProcessingPolicy.window_after_replenishment`
возвращает окно обработки:

- `PROCESS_BACKLOG` — `include_backlog=True`, стартовая отметка не ограничена.
- `ONLY_NEW` — обработка только новых событий, начиная с времени пополнения.
